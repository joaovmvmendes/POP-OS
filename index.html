<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fluxo de Abertura de OS — Documentação</title>

  <style>
    :root{
      --bg:#F8FAFC;
      --card:#FFFFFF;
      --text:#111827;
      --muted:#6B7280;
      --border:#E5E7EB;
      --soft:#F9FAFB;

      --ok-bg:#F0FDF4;
      --ok-bd:#A7F3D0;
      --ok-tx:#065F46;

      --warn-bg:#FFFBEB;
      --warn-bd:#FCD34D;
      --warn-tx:#78350F;

      --err-bg:#FEF2F2;
      --err-bd:#FECACA;
      --err-tx:#7F1D1D;

      --shadow: 0 1px 2px rgba(0,0,0,.04);

      /* Altura usada para offset do scroll */
      --topbar-h: 56px;
    }

    *{ box-sizing:border-box; }
    html{ scroll-behavior:smooth; }
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family: Arial, Helvetica, sans-serif;
      line-height:1.6;
    }

    /* Evita que o scroll "cole" por baixo da barra fixa */
    [id]{ scroll-margin-top: calc(var(--topbar-h) + 16px); }

    /* ========== TOP NAV FIXA ========== */
    .topnav{
      position:fixed;
      top:0; left:0; right:0;
      z-index:9000;
      background:rgba(248,250,252,.9);
      backdrop-filter: blur(10px);
      border-bottom:1px solid var(--border);
    }
    .topnav-inner{
      max-width:980px;
      margin:0 auto;
      padding:10px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .topnav-left{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }
    .topnav-title{
      font-size:12px;
      color:#374151;
      font-weight:700;
      white-space:nowrap;
    }
    .topnav-actions{
      display:flex;
      gap:8px;
      align-items:center;
    }
    .topnav-btn{
      appearance:none;
      border:1px solid var(--border);
      background:var(--card);
      border-radius:10px;
      padding:8px 10px;
      font-size:12px;
      cursor:pointer;
      color:#374151;
      box-shadow:var(--shadow);
      user-select:none;
    }
    .topnav-btn:hover{ background:var(--soft); }

    .topnav-links{
      max-width:980px;
      margin:0 auto;
      padding:0 14px 10px;
      display:none;
    }
    .topnav-links.is-open{ display:block; }

    .topnav-links .toc{
      margin-top:0;
    }

    /* No desktop, mostra a barra sempre aberta */
    @media (min-width: 860px){
      :root{ --topbar-h: 92px; }
      .topnav-links{ display:block; }
      .topnav-btn{ display:none; }
      .topnav-inner{ padding-bottom:6px; }
      .topnav-links{ padding-bottom:12px; }
    }

    /* Quando lightbox estiver aberto, não atrapalhar */
    .topnav.is-hidden{ display:none; }

    /* ========== LAYOUT ========== */
    .wrap{
      width:100%;
      padding:28px 14px;
      text-align:center;
      /* reserva espaço da barra fixa */
      padding-top: calc(var(--topbar-h) + 18px);
    }
    .container{
      max-width:980px;
      margin:0 auto;
      text-align:left;
    }

    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:12px;
      padding:18px;
      box-shadow:var(--shadow);
    }
    .card + .card{ margin-top:16px; }

    .header{ padding:22px; }

    .title{
      font-size:24px;
      font-weight:700;
      margin:0;
    }
    .subtitle{
      margin-top:6px;
      font-size:13px;
      color:var(--muted);
    }

    .badges{
      margin-top:14px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    .badge{
      font-size:12px;
      padding:6px 10px;
      border:1px solid var(--border);
      background:var(--soft);
      border-radius:999px;
      color:#374151;
      white-space:nowrap;
    }
    .badge-ok{
      border-color:var(--ok-bd);
      background:var(--ok-bg);
      color:var(--ok-tx);
      font-weight:700;
    }

    .toc{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:10px;
    }
    .toc a{
      text-decoration:none;
      color:#374151;
      border:1px solid var(--border);
      background:var(--soft);
      border-radius:10px;
      padding:8px 10px;
      font-size:12px;
      display:inline-block;
    }
    .toc a:hover{ background:#F3F4F6; }

    .h2{
      font-size:18px;
      font-weight:700;
      margin:0 0 8px 0;
    }
    .h3{
      font-size:14px;
      font-weight:700;
      margin:14px 0 6px;
    }
    .muted{ color:var(--muted); font-size:13px; }

    .note{
      border:1px solid var(--border);
      background:var(--soft);
      border-left:4px solid #D1D5DB;
      border-radius:10px;
      padding:12px;
      font-size:13px;
      color:#374151;
      margin-top:12px;
    }
    .note code{
      font-family: Consolas, Monaco, monospace;
      font-size:12px;
    }

    .callout-warn{
      border:1px solid var(--warn-bd);
      background:var(--warn-bg);
      color:var(--warn-tx);
      border-radius:12px;
      padding:16px;
      margin-top:16px;
    }
    .callout-warn .h2{ color:#92400E; }

    .callout-err{
      border:1px solid var(--err-bd);
      background:var(--err-bg);
      color:var(--err-tx);
      border-radius:12px;
      padding:16px;
      margin-top:16px;
    }
    .callout-err .h2{ color:#991B1B; }

    ul,ol{ margin:8px 0 0; padding-left:18px; }
    li{ margin:4px 0; }

    .step-meta{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:10px;
    }
    .pill{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      background:var(--soft);
      color:#374151;
    }

    .imgbox{
      margin-top:12px;
      padding:12px;
      border:1px dashed #D1D5DB;
      border-radius:10px;
      background:#fff;
    }
    .imgbox .cap{
      font-size:12px;
      color:var(--muted);
      margin-top:8px;
    }

    /* clickable */
    .imgbox a.zoom{
      display:block;
      text-decoration:none;
      color:inherit;
    }
    .imgbox img{
      width:100%;
      height:auto;
      border:1px solid var(--border);
      border-radius:10px;
      display:block;
      cursor:zoom-in;
    }

    /* Lightbox */
    .lightbox{
      position:fixed;
      inset:0;
      background:rgba(17,24,39,.82);
      display:none;
      align-items:center;
      justify-content:center;
      padding:24px 14px;
      z-index:9999;
    }
    .lightbox.is-open{ display:flex; }

    .lightbox-card{
      width:min(1300px, 96vw);
      max-height:92vh;
      background:#0B1220;
      border:1px solid rgba(229,231,235,.18);
      border-radius:14px;
      overflow:hidden;
      box-shadow:0 18px 60px rgba(0,0,0,.35);
    }
    .lightbox-top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:10px 12px;
      background:rgba(255,255,255,.06);
      border-bottom:1px solid rgba(229,231,235,.12);
    }
    .lightbox-title{
      font-size:12px;
      color:#E5E7EB;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
      max-width:60vw;
    }
    .lightbox-actions{
      display:flex;
      gap:8px;
      align-items:center;
      flex-shrink:0;
    }
    .lb-btn{
      appearance:none;
      border:1px solid rgba(229,231,235,.22);
      background:rgba(255,255,255,.08);
      color:#E5E7EB;
      border-radius:10px;
      padding:8px 10px;
      font-size:12px;
      cursor:pointer;
      user-select:none;
    }
    .lb-btn:hover{ background:rgba(255,255,255,.14); }

    .lightbox-body{
      background:#0B1220;
      padding:12px;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      touch-action:none;
    }

    .lb-stage{
      width:100%;
      height:78vh;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      position:relative;
      cursor:grab;
    }
    .lb-stage.is-dragging{ cursor:grabbing; }

    .lb-img{
      max-width:none;
      max-height:none;
      border-radius:10px;
      border:1px solid rgba(229,231,235,.18);
      display:block;
      transform-origin:center center;
      will-change:transform;
      user-select:none;
      -webkit-user-drag:none;
      cursor:inherit;
    }

    .lightbox-caption{
      padding:10px 12px 12px;
      font-size:12px;
      color:#D1D5DB;
      background:#0B1220;
    }

    .footer{
      margin-top:18px;
      font-size:12px;
      color:var(--muted);
      text-align:left;
    }

    @media (max-width: 520px){
      .lightbox-title{ max-width:44vw; }
      .lb-btn{ padding:8px 8px; }
    }
  </style>
</head>

<body>
  <!-- TOP NAV FIXA -->
  <div class="topnav" id="topnav">
    <div class="topnav-inner">
      <div class="topnav-left">
        <div class="topnav-title">Navegação rápida</div>
      </div>
      <div class="topnav-actions">
        <button class="topnav-btn" type="button" id="navToggle">☰ Navegação</button>
      </div>
    </div>

    <div class="topnav-links" id="navLinks">
      <div class="toc">
        <a href="#top">Topo</a>
        <a href="#visao-geral">Visão geral</a>
        <a href="#etapa-1">Etapa 1</a>
        <a href="#etapa-2">Etapa 2</a>
        <a href="#etapa-3">Etapa 3 (Urgência)</a>
        <a href="#etapa-4">Etapa 4</a>
        <a href="#etapa-5">Etapa 5</a>
        <a href="#etapa-6">Etapa 6</a>
        <a href="#etapa-7">Etapa 7</a>
        <a href="#etapa-8">Etapa 8</a>
        <a href="#etapa-9">Etapa 9</a>
        <a href="#identificacao">Identificação</a>
        <a href="#regras">Regras críticas</a>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="container">

      <!-- HEADER -->
      <div class="card header" id="top">
        <h1 class="title">Fluxo de Abertura de Ordem de Serviço (OS)</h1>
        <div class="subtitle">
          Documentação operacional completa do processo de solicitação, avaliação de urgência, briefing, orçamento, aprovação e encerramento.
        </div>

        <div class="badges">
          <span class="badge"><b>Canal:</b> Feed Bitrix24</span>
          <span class="badge"><b>Origem:</b> Fluxos de Trabalho</span>
          <span class="badge"><b>Destino:</b> SPA Única de OS</span>
          <span class="badge"><b>Governança:</b> Processo automatizado</span>
          <span class="badge badge-ok">Ativo</span>
        </div>

        <div class="note">
          A navegação rápida agora fica <b>fixa no topo</b> da tela.
        </div>
      </div>

      <!-- VISÃO GERAL -->
      <div class="card" id="visao-geral">
        <div class="h2">Visão geral do processo</div>
        <div class="muted">
          O processo padroniza a criação de Ordens de Serviço entre unidades de negócio, garantindo rastreabilidade,
          clareza de responsabilidades, formalização de briefing e controle de orçamento antes de qualquer execução.
        </div>

        <div class="h3">Entidades envolvidas</div>
        <ul>
          <li><b>Solicitante:</b> unidade que abre a OS e fornece as informações de demanda.</li>
          <li><b>Unidade Prestadora:</b> unidade que analisa, define briefing, elabora orçamento e executa após aprovação.</li>
          <li><b>Aprovador de urgência:</b> Dr. Roberto Régis (somente em OS marcadas como Urgentes).</li>
          <li><b>Responsável da unidade solicitante:</b> aprova/recusa o orçamento.</li>
        </ul>

        <div class="h3">Resultado esperado</div>
        <ul>
          <li>OS registrada na <b>SPA Única</b>, com informações completas.</li>
          <li>Se aplicável: urgência avaliada, briefing registrado, orçamento formalizado.</li>
          <li>Execução autorizada <b>apenas após aprovação final do orçamento</b>.</li>
        </ul>
      </div>

      <!-- ETAPA 1 -->
      <div class="card" id="etapa-1">
        <div class="h2">Etapa 1 — Início da solicitação (Solicitante)</div>
        <div class="step-meta">
          <span class="pill"><b>Papel:</b> Solicitante</span>
          <span class="pill"><b>Canal:</b> Feed → Fluxos de Trabalho</span>
          <span class="pill"><b>Saída:</b> Formulário da OS aberto</span>
        </div>

        <div class="h3">O que acontece</div>
        <div class="muted">
          O solicitante acessa o fluxo “Realizar solicitação de OS” no Feed e inicia o processo formal de abertura.
        </div>

        <div class="h3">Como prosseguir (passo a passo)</div>
        <ol>
          <li>Acessar o <b>Feed</b></li>
          <li>Clicar em <b>Mais</b> → <b>Fluxos de Trabalho</b></li>
          <li>Procurar <b>“Realizar solicitação de OS”</b></li>
          <li>Clicar em <b>Iniciar</b></li>
          <li>Na tela seguinte, clicar em <b>Próximo</b></li>
        </ol>

        <div class="h3">Evidências (exemplos)</div>

        <div class="imgbox">
          <a class="zoom" href="Imagem%201.png" data-src="Imagem%201.png"
             data-alt="Imagem 1 — Acesso ao fluxo Realizar solicitação de OS"
             data-cap="Imagem 1 — Exemplo: acesso ao fluxo “Realizar solicitação de OS”">
            <img src="Imagem%201.png"
                 alt="Imagem 1 — Acesso ao fluxo Realizar solicitação de OS"
                 onerror="this.onerror=null;this.src='Imagem%201.jpg';this.onerror=function(){this.src='Imagem%201.jpeg';}">
          </a>
          <div class="cap">Imagem 1 — Exemplo: acesso ao fluxo “Realizar solicitação de OS”</div>
        </div>

        <div class="imgbox">
          <a class="zoom" href="Imagem%202.png" data-src="Imagem%202.png"
             data-alt="Imagem 2 — Tela inicial do fluxo (Próximo)"
             data-cap="Imagem 2 — Exemplo: tela inicial do fluxo (botão Próximo)">
            <img src="Imagem%202.png"
                 alt="Imagem 2 — Tela inicial do fluxo (Próximo)"
                 onerror="this.onerror=null;this.src='Imagem%202.jpg';this.onerror=function(){this.src='Imagem%202.jpeg';}">
          </a>
          <div class="cap">Imagem 2 — Exemplo: tela inicial do fluxo (botão Próximo)</div>
        </div>
      </div>

      <!-- ETAPA 2 -->
      <div class="card" id="etapa-2">
        <div class="h2">Etapa 2 — Preenchimento da solicitação (Solicitante)</div>
        <div class="step-meta">
          <span class="pill"><b>Papel:</b> Solicitante</span>
          <span class="pill"><b>Entrada:</b> Formulário aberto</span>
          <span class="pill"><b>Saída:</b> Solicitação iniciada</span>
        </div>

        <div class="h3">O que acontece</div>
        <div class="muted">
          O solicitante fornece os dados necessários para que a unidade prestadora entenda objetivo, justificativa,
          escopo e evidências (anexos). O correto preenchimento é crítico, pois o fluxo não pode ser reiniciado.
        </div>

        <div class="h3">Campos e orientações</div>
        <ul>
          <li><b>Solicitante:</b> sua unidade de negócio.</li>
          <li><b>Tipo de serviço:</b> <b>Programado</b> (prazo maior) ou <b>Urgente</b> (gera avaliação de urgência).</li>
          <li><b>Expectativa de prazo para entrega:</b> data que você espera a entrega.</li>
          <li><b>Prestador:</b> unidade de negócio que prestará o serviço.</li>
          <li><b>Tipo de OS:</b> <b>Interna</b> (entre unidades) ou <b>Externa</b> (representando cliente externo).</li>
          <li><b>Cliente Externo:</b> obrigatório se Tipo de OS = Externa.</li>
          <li><b>Objetivo:</b> resultado final esperado (ex.: “sistema de abertura de OS completo”).</li>
          <li><b>Justificativa:</b> motivo do pedido (ex.: necessidade de negociação/valores de prestação de serviço).</li>
          <li><b>Descrição:</b> detalhes técnicos/funcionais (ex.: níveis de acesso, regras, escopo).</li>
          <li><b>Anexos:</b> arquivos de apoio (prints, documentos, especificações).</li>
        </ul>

        <div class="h3">Como prosseguir</div>
        <div class="muted">Após preencher todos os campos, clicar em <b>Iniciar</b>.</div>

        <div class="imgbox">
          <a class="zoom" href="Imagem%203.png" data-src="Imagem%203.png"
             data-alt="Imagem 3 — Formulário preenchido"
             data-cap="Imagem 3 — Exemplo: formulário de solicitação preenchido">
            <img src="Imagem%203.png"
                 alt="Imagem 3 — Formulário preenchido"
                 onerror="this.onerror=null;this.src='Imagem%203.jpg';this.onerror=function(){this.src='Imagem%203.jpeg';}">
          </a>
          <div class="cap">Imagem 3 — Exemplo: formulário de solicitação preenchido</div>
        </div>

        <div class="note">
          <b>Regra:</b> Se o Tipo de Serviço NÃO for Urgente, o fluxo segue diretamente para a <b>verificação de briefing</b>.
        </div>
      </div>

      <!-- ETAPA 3 (URGÊNCIA) -->
      <div class="callout-warn" id="etapa-3">
        <div class="h2">Etapa 3 — Avaliação de urgência (somente quando Tipo de Serviço = Urgente)</div>

        <div class="step-meta" style="margin-top:10px;">
          <span class="pill"><b>Papel:</b> Aprovador de urgência</span>
          <span class="pill"><b>Responsável:</b> Dr. Roberto Régis</span>
          <span class="pill"><b>Saída:</b> Urgência aprovada ou recusada</span>
        </div>

        <div class="h3">O que acontece</div>
        <div class="muted" style="color:var(--warn-tx);">
          Ao definir o Tipo de Serviço como <b>Urgente</b>, a solicitação é encaminhada para avaliação do Dr. Roberto Régis,
          que decide se a urgência é necessária.
        </div>

        <div class="h3">Decisão e consequências</div>
        <ul>
          <li><b>Se aprovada:</b> o fluxo segue normalmente para a unidade prestadora.</li>
          <li><b>Se recusada:</b> o card da SPA vai para a raia <b>“Ordem de urgência recusada”</b> e o fluxo é encerrado.</li>
          <li><b>Obrigatório na recusa:</b> preencher o campo <b>“Motivo da recusa da OS”</b>.</li>
        </ul>

        <div class="h3">Evidências (exemplos)</div>

        <div class="imgbox">
          <a class="zoom" href="Imagem%204.png" data-src="Imagem%204.png"
             data-alt="Imagem 4 — Notificação ao solicitante (OS urgente)"
             data-cap="Imagem 4 — Exemplo: notificação ao solicitante (OS urgente)">
            <img src="Imagem%204.png" alt="Imagem 4 — Notificação ao solicitante (OS urgente)"
                 onerror="this.onerror=null;this.src='Imagem%204.jpg';this.onerror=function(){this.src='Imagem%204.jpeg';}">
          </a>
          <div class="cap">Imagem 4 — Exemplo: notificação ao solicitante (OS urgente)</div>
        </div>

        <div class="imgbox">
          <a class="zoom" href="Imagem%205.png" data-src="Imagem%205.png"
             data-alt="Imagem 5 — Fluxo de aprovação no feed"
             data-cap="Imagem 5 — Exemplo: fluxo de aprovação de urgência no feed do aprovador">
            <img src="Imagem%205.png" alt="Imagem 5 — Fluxo de aprovação no feed"
                 onerror="this.onerror=null;this.src='Imagem%205.jpg';this.onerror=function(){this.src='Imagem%205.jpeg';}">
          </a>
          <div class="cap">Imagem 5 — Exemplo: fluxo de aprovação de urgência no feed do aprovador</div>
        </div>

        <div class="imgbox">
          <a class="zoom" href="Imagem%206.png" data-src="Imagem%206.png"
             data-alt="Imagem 6 — Aprovação/recusa (motivo obrigatório)"
             data-cap="Imagem 6 — Exemplo: aprovação/recusa (motivo obrigatório na recusa)">
            <img src="Imagem%206.png" alt="Imagem 6 — Aprovação/recusa (motivo obrigatório)"
                 onerror="this.onerror=null;this.src='Imagem%206.jpg';this.onerror=function(){this.src='Imagem%206.jpeg';}">
          </a>
          <div class="cap">Imagem 6 — Exemplo: aprovação/recusa (motivo obrigatório na recusa)</div>
        </div>

        <div class="imgbox">
          <a class="zoom" href="Imagem%207.png" data-src="Imagem%207.png"
             data-alt="Imagem 7 — Notificação ao solicitante (recusa + anotações)"
             data-cap="Imagem 7 — Exemplo: notificação ao solicitante (recusa + “Anotações” com motivo)">
            <img src="Imagem%207.png" alt="Imagem 7 — Notificação ao solicitante (recusa + anotações)"
                 onerror="this.onerror=null;this.src='Imagem%207.jpg';this.onerror=function(){this.src='Imagem%207.jpeg';}">
          </a>
          <div class="cap">Imagem 7 — Exemplo: notificação ao solicitante (recusa + “Anotações” com motivo)</div>
        </div>

        <div class="imgbox">
          <a class="zoom" href="Imagem%208.png" data-src="Imagem%208.png"
             data-alt="Imagem 8 — Mensagem ao solicitante (recusa + anotações)"
             data-cap="Imagem 8 — Exemplo: mensagem ao solicitante (recusa + “Anotações” com motivo)">
            <img src="Imagem%208.png" alt="Imagem 8 — Mensagem ao solicitante (recusa + anotações)"
                 onerror="this.onerror=null;this.src='Imagem%208.jpg';this.onerror=function(){this.src='Imagem%208.jpeg';}">
          </a>
          <div class="cap">Imagem 8 — Exemplo: mensagem ao solicitante (recusa + “Anotações” com motivo)</div>
        </div>
      </div>

      <!-- ETAPA 4 -->
      <div class="card" id="etapa-4">
        <div class="h2">Etapa 4 — Verificação de necessidade de briefing (Unidade Prestadora)</div>
        <div class="step-meta">
          <span class="pill"><b>Papel:</b> Unidade Prestadora</span>
          <span class="pill"><b>Entrada:</b> OS criada/encaminhada</span>
          <span class="pill"><b>Saída:</b> Precisa ou não precisa briefing</span>
        </div>

        <div class="h3">O que acontece</div>
        <div class="muted">
          Após aprovação de urgência (ou quando a OS não é urgente), o solicitante é informado que a OS está
          em verificação para determinar se será necessário um briefing (reunião) para eliminar dúvidas e lacunas.
        </div>

        <div class="h3">Como prosseguir (Unidade Prestadora)</div>
        <ul>
          <li>Acessar o fluxo no Feed.</li>
          <li>Tomar a decisão: <b>PRECISA DE BRIEFING</b> ou <b>NÃO PRECISA</b>.</li>
          <li><b>Se PRECISA DE BRIEFING:</b> informar obrigatoriamente o motivo (o solicitante será notificado).</li>
        </ul>

        <div class="note">
          <b>Responsabilidade operacional:</b> se precisar briefing, o responsável da unidade prestadora deve contatar o solicitante para combinar agenda.
        </div>

        <div class="imgbox">
          <a class="zoom" href="Imagem%209.png" data-src="Imagem%209.png" data-alt="Imagem 9" data-cap="Imagem 9 — Exemplo: notificação ao solicitante sobre necessidade de briefing">
            <img src="Imagem%209.png" alt="Imagem 9"
                 onerror="this.onerror=null;this.src='Imagem%209.jpg';this.onerror=function(){this.src='Imagem%209.jpeg';}">
          </a>
          <div class="cap">Imagem 9 — Exemplo: notificação ao solicitante sobre necessidade de briefing</div>
        </div>

        <div class="imgbox">
          <a class="zoom" href="Imagem%2010.png" data-src="Imagem%2010.png" data-alt="Imagem 10" data-cap="Imagem 10 — Exemplo: mensagem ao solicitante sobre necessidade de briefing">
            <img src="Imagem%2010.png" alt="Imagem 10"
                 onerror="this.onerror=null;this.src='Imagem%2010.jpg';this.onerror=function(){this.src='Imagem%2010.jpeg';}">
          </a>
          <div class="cap">Imagem 10 — Exemplo: mensagem ao solicitante sobre necessidade de briefing</div>
        </div>

        <div class="imgbox">
          <a class="zoom" href="Imagem%2011.png" data-src="Imagem%2011.png" data-alt="Imagem 11" data-cap="Imagem 11 — Exemplo: notificação ao prestador para verificação de briefing">
            <img src="Imagem%2011.png" alt="Imagem 11"
                 onerror="this.onerror=null;this.src='Imagem%2011.jpg';this.onerror=function(){this.src='Imagem%2011.jpeg';}">
          </a>
          <div class="cap">Imagem 11 — Exemplo: notificação ao prestador para verificação de briefing</div>
        </div>

        <div class="imgbox">
          <a class="zoom" href="Imagem%2012.png" data-src="Imagem%2012.png" data-alt="Imagem 12" data-cap="Imagem 12 — Exemplo: mensagem ao prestador para verificação de briefing">
            <img src="Imagem%2012.png" alt="Imagem 12"
                 onerror="this.onerror=null;this.src='Imagem%2012.jpg';this.onerror=function(){this.src='Imagem%2012.jpeg';}">
          </a>
          <div class="cap">Imagem 12 — Exemplo: mensagem ao prestador para verificação de briefing</div>
        </div>

        <div class="imgbox">
          <a class="zoom" href="Imagem%2013.png" data-src="Imagem%2013.png" data-alt="Imagem 13" data-cap="Imagem 13 — Exemplo: fluxo no feed para verificação de briefing">
            <img src="Imagem%2013.png" alt="Imagem 13"
                 onerror="this.onerror=null;this.src='Imagem%2013.jpg';this.onerror=function(){this.src='Imagem%2013.jpeg';}">
          </a>
          <div class="cap">Imagem 13 — Exemplo: fluxo no feed para verificação de briefing</div>
        </div>

        <div class="imgbox">
          <a class="zoom" href="Imagem%2014.png" data-src="Imagem%2014.png" data-alt="Imagem 14" data-cap="Imagem 14 — Exemplo: decisão de briefing (motivo obrigatório ao selecionar “PRECISA DE BRIEFING”)">
            <img src="Imagem%2014.png" alt="Imagem 14"
                 onerror="this.onerror=null;this.src='Imagem%2014.jpg';this.onerror=function(){this.src='Imagem%2014.jpeg';}">
          </a>
          <div class="cap">Imagem 14 — Exemplo: decisão de briefing (motivo obrigatório ao selecionar “PRECISA DE BRIEFING”)</div>
        </div>

        <div class="imgbox">
          <a class="zoom" href="Imagem%2015.png" data-src="Imagem%2015.png" data-alt="Imagem 15" data-cap="Imagem 15 — Exemplo: notificação ao solicitante (briefing necessário)">
            <img src="Imagem%2015.png" alt="Imagem 15"
                 onerror="this.onerror=null;this.src='Imagem%2015.jpg';this.onerror=function(){this.src='Imagem%2015.jpeg';}">
          </a>
          <div class="cap">Imagem 15 — Exemplo: notificação ao solicitante (briefing necessário)</div>
        </div>

        <div class="imgbox">
          <a class="zoom" href="Imagem%2016.png" data-src="Imagem%2016.png" data-alt="Imagem 16" data-cap="Imagem 16 — Exemplo: mensagem ao solicitante (briefing necessário)">
            <img src="Imagem%2016.png" alt="Imagem 16"
                 onerror="this.onerror=null;this.src='Imagem%2016.jpg';this.onerror=function(){this.src='Imagem%2016.jpeg';}">
          </a>
          <div class="cap">Imagem 16 — Exemplo: mensagem ao solicitante (briefing necessário)</div>
        </div>
      </div>

      <!-- ETAPA 5 -->
      <div class="card" id="etapa-5">
        <div class="h2">Etapa 5 — Marcação da reunião de briefing (Unidade Prestadora)</div>
        <div class="step-meta">
          <span class="pill"><b>Papel:</b> Unidade Prestadora</span>
          <span class="pill"><b>Ação:</b> Marcar reunião no fluxo</span>
          <span class="pill"><b>Saída:</b> Reunião criada e solicitante notificado</span>
        </div>

        <div class="h3">O que acontece</div>
        <div class="muted">
          Após selecionar “PRECISA DE BRIEFING”, o fluxo é atualizado e passa a solicitar os dados da reunião.
          O card permanece aguardando continuidade no Feed.
        </div>

        <div class="h3">Como prosseguir</div>
        <ul>
          <li>Preencher <b>data/hora de início</b> e <b>data/hora de término</b>.</li>
          <li>Selecionar <b>participantes</b>.</li>
          <li>Informar <b>local</b> (recomendado: “Online” ou “Presencial”).</li>
          <li>Clicar em <b>MARCAR REUNIÃO</b>.</li>
        </ul>

        <div class="note">
          <b>Importante:</b> o campo de local é ilustrativo e não sincroniza automaticamente com reservas de sala.
          Se presencial, reserve a sala manualmente após marcar a reunião.
        </div>

        <div class="imgbox">
          <a class="zoom" href="Imagem%2017.png" data-src="Imagem%2017.png" data-alt="Imagem 17" data-cap="Imagem 17 — Exemplo: fluxo ainda no feed após selecionar “PRECISA DE BRIEFING”">
            <img src="Imagem%2017.png" alt="Imagem 17"
                 onerror="this.onerror=null;this.src='Imagem%2017.jpg';this.onerror=function(){this.src='Imagem%2017.jpeg';}">
          </a>
          <div class="cap">Imagem 17 — Exemplo: fluxo ainda no feed após selecionar “PRECISA DE BRIEFING”</div>
        </div>

        <div class="imgbox">
          <a class="zoom" href="Imagem%2018.png" data-src="Imagem%2018.png" data-alt="Imagem 18" data-cap="Imagem 18 — Exemplo: tela do fluxo atualizada para marcar reunião">
            <img src="Imagem%2018.png" alt="Imagem 18"
                 onerror="this.onerror=null;this.src='Imagem%2018.jpg';this.onerror=function(){this.src='Imagem%2018.jpeg';}">
          </a>
          <div class="cap">Imagem 18 — Exemplo: tela do fluxo atualizada para marcar reunião</div>
        </div>

        <div class="imgbox">
          <a class="zoom" href="Imagem%2019.png" data-src="Imagem%2019.png" data-alt="Imagem 19" data-cap="Imagem 19 — Exemplo: notificação ao solicitante com dados da reunião">
            <img src="Imagem%2019.png" alt="Imagem 19"
                 onerror="this.onerror=null;this.src='Imagem%2019.jpg';this.onerror=function(){this.src='Imagem%2019.jpeg';}">
          </a>
          <div class="cap">Imagem 19 — Exemplo: notificação ao solicitante com dados da reunião</div>
        </div>

        <div class="imgbox">
          <a class="zoom" href="Imagem%2020.png" data-src="Imagem%2020.png" data-alt="Imagem 20" data-cap="Imagem 20 — Exemplo: mensagem ao solicitante com dados da reunião">
            <img src="Imagem%2020.png" alt="Imagem 20"
                 onerror="this.onerror=null;this.src='Imagem%2020.jpg';this.onerror=function(){this.src='Imagem%2020.jpeg';}">
          </a>
          <div class="cap">Imagem 20 — Exemplo: mensagem ao solicitante com dados da reunião</div>
        </div>

        <div class="imgbox">
          <a class="zoom" href="Imagem%2021.png" data-src="Imagem%2021.png" data-alt="Imagem 21" data-cap="Imagem 21 — Exemplo: reunião criada para tratar do briefing">
            <img src="Imagem%2021.png" alt="Imagem 21"
                 onerror="this.onerror=null;this.src='Imagem%2021.jpg';this.onerror=function(){this.src='Imagem%2021.jpeg';}">
          </a>
          <div class="cap">Imagem 21 — Exemplo: reunião criada para tratar do briefing</div>
        </div>

        <div class="note">
          Após marcar, a tela pode atualizar para uma próxima etapa que depende de informações que você só terá após a reunião.
          Você pode fechar o fluxo e retornar depois.
        </div>
      </div>

      <!-- ETAPA 6 -->
      <div class="card" id="etapa-6">
        <div class="h2">Etapa 6 — Preenchimento das informações para orçamento (Unidade Prestadora)</div>
        <div class="step-meta">
          <span class="pill"><b>Papel:</b> Unidade Prestadora</span>
          <span class="pill"><b>Entrada:</b> Briefing realizado</span>
          <span class="pill"><b>Saída:</b> Orçamento gerado</span>
        </div>

        <div class="h3">O que acontece</div>
        <div class="muted">
          O responsável da unidade prestadora recebe notificação/mensagem para preencher dados que permitirão gerar o orçamento.
          O orçamento é então enviado ao responsável da unidade solicitante para aprovação/recusa.
        </div>

        <div class="h3">Como preencher (critérios)</div>
        <ul>
          <li><b>Executor(es):</b> quem executará a OS.</li>
          <li><b>Data de conclusão:</b> prazo <b>realista</b> (data e hora), mesmo que diferente da expectativa do solicitante.</li>
          <li><b>Produto:</b> selecione se existir 1 produto mapeado.</li>
          <li><b>Produto personalizado:</b> se houver múltiplos produtos, deixe “Produto” em branco e liste todos aqui.</li>
          <li><b>Valor:</b> total final da OS.</li>
          <li><b>Detalhes dos entregáveis:</b> detalhamento completo, produtos, quantidades e composição dos valores.</li>
        </ul>

        <div class="h3">Como prosseguir</div>
        <div class="muted">Após preencher, clicar em <b>Atribuir detalhes</b>.</div>

        <div class="imgbox">
          <a class="zoom" href="Imagem%2022.png" data-src="Imagem%2022.png" data-alt="Imagem 22" data-cap="Imagem 22 — Exemplo: notificação ao prestador para inserir informações do orçamento">
            <img src="Imagem%2022.png" alt="Imagem 22"
                 onerror="this.onerror=null;this.src='Imagem%2022.jpg';this.onerror=function(){this.src='Imagem%2022.jpeg';}">
          </a>
          <div class="cap">Imagem 22 — Exemplo: notificação ao prestador para inserir informações do orçamento</div>
        </div>

        <div class="imgbox">
          <a class="zoom" href="Imagem%2023.png" data-src="Imagem%2023.png" data-alt="Imagem 23" data-cap="Imagem 23 — Exemplo: mensagem ao prestador para inserir informações do orçamento">
            <img src="Imagem%2023.png" alt="Imagem 23"
                 onerror="this.onerror=null;this.src='Imagem%2023.jpg';this.onerror=function(){this.src='Imagem%2023.jpeg';}">
          </a>
          <div class="cap">Imagem 23 — Exemplo: mensagem ao prestador para inserir informações do orçamento</div>
        </div>

        <div class="imgbox">
          <a class="zoom" href="Imagem%2024.png" data-src="Imagem%2024.png" data-alt="Imagem 24" data-cap="Imagem 24 — Exemplo: fluxo no feed aguardando preenchimento do orçamento">
            <img src="Imagem%2024.png" alt="Imagem 24"
                 onerror="this.onerror=null;this.src='Imagem%2024.jpg';this.onerror=function(){this.src='Imagem%2024.jpeg';}">
          </a>
          <div class="cap">Imagem 24 — Exemplo: fluxo no feed aguardando preenchimento do orçamento</div>
        </div>

        <div class="imgbox">
          <a class="zoom" href="Imagem%2025.png" data-src="Imagem%2025.png" data-alt="Imagem 25" data-cap="Imagem 25 — Exemplo: tela para preenchimento do orçamento">
            <img src="Imagem%2025.png" alt="Imagem 25"
                 onerror="this.onerror=null;this.src='Imagem%2025.jpg';this.onerror=function(){this.src='Imagem%2025.jpeg';}">
          </a>
          <div class="cap">Imagem 25 — Exemplo: tela para preenchimento do orçamento</div>
        </div>
      </div>

      <!-- ETAPA 7 -->
      <div class="card" id="etapa-7">
        <div class="h2">Etapa 7 — Aprovação/recusa do orçamento (Responsável da unidade solicitante)</div>
        <div class="step-meta">
          <span class="pill"><b>Papel:</b> Unidade Solicitante (responsável)</span>
          <span class="pill"><b>Ação:</b> Aprovar ou recusar</span>
          <span class="pill"><b>Saída:</b> Aprovado ou devolvido para nova proposta</span>
        </div>

        <div class="h3">O que acontece</div>
        <div class="muted">
          O responsável pela unidade solicitante recebe o orçamento e decide aprovar ou recusar.
          Em caso de recusa, é obrigatório informar o motivo.
        </div>

        <div class="h3">Como prosseguir</div>
        <ul>
          <li>Revisar valor, prazos, entregáveis e condições.</li>
          <li>Selecionar <b>Aprovar</b> ou <b>Recusar</b>.</li>
          <li><b>Se recusar:</b> preencher obrigatoriamente “Por qual motivo está recusando?”.</li>
        </ul>

        <div class="imgbox">
          <a class="zoom" href="Imagem%2026.png" data-src="Imagem%2026.png" data-alt="Imagem 26" data-cap="Imagem 26 — Exemplo: notificação ao responsável solicitante para aprovação do orçamento">
            <img src="Imagem%2026.png" alt="Imagem 26"
                 onerror="this.onerror=null;this.src='Imagem%2026.jpg';this.onerror=function(){this.src='Imagem%2026.jpeg';}">
          </a>
          <div class="cap">Imagem 26 — Exemplo: notificação ao responsável solicitante para aprovação do orçamento</div>
        </div>

        <div class="imgbox">
          <a class="zoom" href="Imagem%2027.png" data-src="Imagem%2027.png" data-alt="Imagem 27" data-cap="Imagem 27 — Exemplo: mensagem ao responsável solicitante para aprovação do orçamento">
            <img src="Imagem%2027.png" alt="Imagem 27"
                 onerror="this.onerror=null;this.src='Imagem%2027.jpg';this.onerror=function(){this.src='Imagem%2027.jpeg';}">
          </a>
          <div class="cap">Imagem 27 — Exemplo: mensagem ao responsável solicitante para aprovação do orçamento</div>
        </div>

        <div class="imgbox">
          <a class="zoom" href="Imagem%2028.png" data-src="Imagem%2028.png" data-alt="Imagem 28" data-cap="Imagem 28 — Exemplo: fluxo no feed para aprovação/recusa do orçamento">
            <img src="Imagem%2028.png" alt="Imagem 28"
                 onerror="this.onerror=null;this.src='Imagem%2028.jpg';this.onerror=function(){this.src='Imagem%2028.jpeg';}">
          </a>
          <div class="cap">Imagem 28 — Exemplo: fluxo no feed para aprovação/recusa do orçamento</div>
        </div>

        <div class="imgbox">
          <a class="zoom" href="Imagem%2029.png" data-src="Imagem%2029.png" data-alt="Imagem 29" data-cap="Imagem 29 — Exemplo: tela de aprovação/recusa (motivo obrigatório em recusa)">
            <img src="Imagem%2029.png" alt="Imagem 29"
                 onerror="this.onerror=null;this.src='Imagem%2029.jpg';this.onerror=function(){this.src='Imagem%2029.jpeg';}">
          </a>
          <div class="cap">Imagem 29 — Exemplo: tela de aprovação/recusa (motivo obrigatório em recusa)</div>
        </div>
      </div>

      <!-- ETAPA 8 -->
      <div class="card" id="etapa-8">
        <div class="h2">Etapa 8 — Recusa do orçamento: nova proposta ou cancelamento (Unidade Prestadora)</div>
        <div class="step-meta">
          <span class="pill"><b>Papel:</b> Unidade Prestadora</span>
          <span class="pill"><b>Entrada:</b> Orçamento recusado</span>
          <span class="pill"><b>Saída:</b> Nova proposta enviada ou negociação cancelada</span>
        </div>

        <div class="h3">O que acontece</div>
        <div class="muted">
          Se houver recusa, a unidade prestadora recebe os detalhes e pode:
          (1) enviar nova proposta; ou (2) cancelar a negociação.
        </div>

        <div class="note">
          <b>Obrigatório ao reenviar:</b> preencher “Explique quais foram as mudanças na sua proposta!”.
          O sistema reprocesa e volta ao fluxo de aprovação do solicitante.
        </div>

        <div class="imgbox">
          <a class="zoom" href="Imagem%2030.png" data-src="Imagem%2030.png" data-alt="Imagem 30" data-cap="Imagem 30 — Exemplo: notificação de recusa para a unidade prestadora">
            <img src="Imagem%2030.png" alt="Imagem 30"
                 onerror="this.onerror=null;this.src='Imagem%2030.jpg';this.onerror=function(){this.src='Imagem%2030.jpeg';}">
          </a>
          <div class="cap">Imagem 30 — Exemplo: notificação de recusa para a unidade prestadora</div>
        </div>

        <div class="imgbox">
          <a class="zoom" href="Imagem%2031.png" data-src="Imagem%2031.png" data-alt="Imagem 31" data-cap="Imagem 31 — Exemplo: mensagem de recusa para a unidade prestadora">
            <img src="Imagem%2031.png" alt="Imagem 31"
                 onerror="this.onerror=null;this.src='Imagem%2031.jpg';this.onerror=function(){this.src='Imagem%2031.jpeg';}">
          </a>
          <div class="cap">Imagem 31 — Exemplo: mensagem de recusa para a unidade prestadora</div>
        </div>

        <div class="imgbox">
          <a class="zoom" href="Imagem%2032.png" data-src="Imagem%2032.png" data-alt="Imagem 32" data-cap="Imagem 32 — Exemplo: fluxo no feed para envio de nova proposta">
            <img src="Imagem%2032.png" alt="Imagem 32"
                 onerror="this.onerror=null;this.src='Imagem%2032.jpg';this.onerror=function(){this.src='Imagem%2032.jpeg';}">
          </a>
          <div class="cap">Imagem 32 — Exemplo: fluxo no feed para envio de nova proposta</div>
        </div>

        <div class="imgbox">
          <a class="zoom" href="Imagem%2033.png" data-src="Imagem%2033.png" data-alt="Imagem 33" data-cap="Imagem 33 — Exemplo: tela para ajustar proposta e reenviar orçamento (mudanças obrigatórias)">
            <img src="Imagem%2033.png" alt="Imagem 33"
                 onerror="this.onerror=null;this.src='Imagem%2033.jpg';this.onerror=function(){this.src='Imagem%2033.jpeg';}">
          </a>
          <div class="cap">Imagem 33 — Exemplo: tela para ajustar proposta e reenviar orçamento (mudanças obrigatórias)</div>
        </div>

        <div class="imgbox">
          <a class="zoom" href="Imagem%2034.png" data-src="Imagem%2034.png" data-alt="Imagem 34" data-cap="Imagem 34 — Exemplo: orçamento gerado após reprocessamento">
            <img src="Imagem%2034.png" alt="Imagem 34"
                 onerror="this.onerror=null;this.src='Imagem%2034.jpg';this.onerror=function(){this.src='Imagem%2034.jpeg';}">
          </a>
          <div class="cap">Imagem 34 — Exemplo: orçamento gerado após reprocessamento</div>
        </div>
      </div>

      <!-- ETAPA 9 -->
      <div class="card" id="etapa-9">
        <div class="h2">Etapa 9 — Aprovação final e encerramento do fluxo</div>
        <div class="step-meta">
          <span class="pill"><b>Papel:</b> Unidade Solicitante / Prestadora</span>
          <span class="pill"><b>Marco:</b> Orçamento aprovado</span>
          <span class="pill"><b>Saída:</b> Execução autorizada</span>
        </div>

        <div class="h3">O que acontece</div>
        <div class="muted">
          Quando o orçamento é aprovado, a unidade prestadora recebe aviso de aprovação.
          O fluxo de abertura da OS é encerrado e a execução passa a ser permitida.
        </div>

        <div class="note">
          <b>Regra:</b> criação de tarefas e execução da OS <b>somente após aprovação do orçamento final</b>.
        </div>

        <div class="imgbox">
          <a class="zoom" href="Imagem%2035.png" data-src="Imagem%2035.png" data-alt="Imagem 35" data-cap="Imagem 35 — Exemplo: notificação ao prestador informando aprovação">
            <img src="Imagem%2035.png" alt="Imagem 35"
                 onerror="this.onerror=null;this.src='Imagem%2035.jpg';this.onerror=function(){this.src='Imagem%2035.jpeg';}">
          </a>
          <div class="cap">Imagem 35 — Exemplo: notificação ao prestador informando aprovação</div>
        </div>

        <div class="imgbox">
          <a class="zoom" href="Imagem%2036.png" data-src="Imagem%2036.png" data-alt="Imagem 36" data-cap="Imagem 36 — Exemplo: mensagem ao prestador informando aprovação">
            <img src="Imagem%2036.png" alt="Imagem 36"
                 onerror="this.onerror=null;this.src='Imagem%2036.jpg';this.onerror=function(){this.src='Imagem%2036.jpeg';}">
          </a>
          <div class="cap">Imagem 36 — Exemplo: mensagem ao prestador informando aprovação</div>
        </div>

        <div class="imgbox">
          <a class="zoom" href="Imagem%2037.png" data-src="Imagem%2037.png" data-alt="Imagem 37" data-cap="Imagem 37 — Exemplo: card após criação/andamento (dados e comentários para leitura rápida)">
            <img src="Imagem%2037.png" alt="Imagem 37"
                 onerror="this.onerror=null;this.src='Imagem%2037.jpg';this.onerror=function(){this.src='Imagem%2037.jpeg';}">
          </a>
          <div class="cap">Imagem 37 — Exemplo: card após criação/andamento (dados e comentários para leitura rápida)</div>
        </div>
      </div>

      <!-- IDENTIFICAÇÃO -->
      <div class="card" id="identificacao">
        <div class="h2">Identificação do título da OS (marcadores)</div>
        <div class="muted">O título possui um padrão para facilitar busca e organização.</div>

        <div class="note" style="font-family:Consolas, Monaco, monospace;">
          Exemplo: <b>OSUE200126BTQ649CAG</b><br>
          OS = Ordem de Serviço<br>
          U = Tipo de serviço (Urgente)<br>
          E = Tipo de OS (Externa)<br>
          200126 = Data de abertura (20/01/2026)<br>
          BTQ = Unidade solicitante (Boutique)<br>
          649 = ID da SPA<br>
          CAG = Unidade prestadora (Comuniq AG)
        </div>

        <div class="muted" style="margin-top:10px;">
          Há apenas <b>uma SPA</b> para unificar todas as OS. Usuários autorizados podem filtrar por título e visualizar itens específicos por unidade.
        </div>
      </div>

      <!-- REGRAS CRÍTICAS -->
      <div class="callout-err" id="regras">
        <div class="h2">Regras críticas e governança do processo</div>
        <ul>
          <li>O fluxo completo só termina após <b>aprovação do orçamento</b> ou <b>cancelamento da negociação</b> pela unidade prestadora.</li>
          <li>Cada etapa ocorre de forma automática — é <b>terminantemente proibido</b> mover o card manualmente na SPA antes de “Orçamento aprovado”.</li>
          <li>A execução da OS e criação de tarefas só devem ocorrer <b>após aprovação do orçamento final</b>.</li>
          <li>O processo não pode ser pausado, retrocedido ou reiniciado. Máxima atenção ao preenchimento dos campos.</li>
          <li>Pontos de decisão no Feed aguardam ação por até <b>7 dias</b>. Sem ação, o fluxo segue com negativa por falta de interação.</li>
          <li>Se perder o rastreio, filtre pelo <b>título da OS</b> e verifique decisões pendentes no Feed.</li>
        </ul>

        <div class="imgbox" style="border-color:#FCA5A5;background:#fff;">
          <a class="zoom" href="Imagem%2038.png" data-src="Imagem%2038.png" data-alt="Imagem 38" data-cap="Imagem 38 — Exemplo: filtro no feed pelo título da OS para localizar pontos de decisão">
            <img src="Imagem%2038.png" alt="Imagem 38"
                 onerror="this.onerror=null;this.src='Imagem%2038.jpg';this.onerror=function(){this.src='Imagem%2038.jpeg';}">
          </a>
          <div class="cap">Imagem 38 — Exemplo: filtro no feed pelo título da OS para localizar pontos de decisão</div>
        </div>
      </div>

      <div class="footer">
        © Documentação interna • <a href="#top" style="color:#374151;">Voltar ao topo</a>
      </div>

    </div>
  </div>

  <!-- LIGHTBOX -->
  <div class="lightbox" id="lightbox" aria-hidden="true">
    <div class="lightbox-card" role="dialog" aria-modal="true" aria-label="Visualização de imagem ampliada">
      <div class="lightbox-top">
        <div class="lightbox-title" id="lbTitle">Imagem</div>
        <div class="lightbox-actions">
          <button class="lb-btn" type="button" id="lbPrev" title="Anterior (←)">←</button>
          <button class="lb-btn" type="button" id="lbZoomOut" title="Diminuir (-)">−</button>
          <button class="lb-btn" type="button" id="lbZoomReset" title="Ajustar (0)">Ajustar</button>
          <button class="lb-btn" type="button" id="lbZoomIn" title="Aumentar (+)">+</button>
          <button class="lb-btn" type="button" id="lbNext" title="Próxima (→)">→</button>
          <button class="lb-btn" type="button" id="lbClose" title="Fechar (Esc)">Fechar</button>
        </div>
      </div>

      <div class="lightbox-body">
        <div class="lb-stage" id="lbStage">
          <img class="lb-img" id="lbImg" alt="">
        </div>
      </div>

      <div class="lightbox-caption" id="lbCaption"></div>
    </div>
  </div>

  <script>
    (function () {
      const topnav = document.getElementById('topnav');
      const navToggle = document.getElementById('navToggle');
      const navLinks = document.getElementById('navLinks');

      // Toggle menu (mobile)
      if (navToggle) {
        navToggle.addEventListener('click', () => {
          navLinks.classList.toggle('is-open');
        });
      }

      // Auto-close menu on link click (mobile)
      document.querySelectorAll('.topnav a[href^="#"]').forEach(a => {
        a.addEventListener('click', () => {
          if (window.matchMedia('(max-width: 859px)').matches) {
            navLinks.classList.remove('is-open');
          }
        });
      });

      // LIGHTBOX
      const lightbox = document.getElementById('lightbox');
      const lbImg = document.getElementById('lbImg');
      const lbTitle = document.getElementById('lbTitle');
      const lbCaption = document.getElementById('lbCaption');
      const lbClose = document.getElementById('lbClose');
      const lbZoomIn = document.getElementById('lbZoomIn');
      const lbZoomOut = document.getElementById('lbZoomOut');
      const lbZoomReset = document.getElementById('lbZoomReset');
      const lbPrev = document.getElementById('lbPrev');
      const lbNext = document.getElementById('lbNext');
      const lbStage = document.getElementById('lbStage');

      const zoomLinks = Array.from(document.querySelectorAll('a.zoom'));
      let currentIndex = -1;

      // Transform state
      let scale = 1;
      let tx = 0;
      let ty = 0;

      // Drag state
      let isDragging = false;
      let startX = 0;
      let startY = 0;
      let startTx = 0;
      let startTy = 0;

      function applyTransform() {
        lbImg.style.transform = `translate(${tx}px, ${ty}px) scale(${scale})`;
      }

      function resetTransform() {
        scale = 1;
        tx = 0;
        ty = 0;
        applyTransform();
      }

      function setImageWithFallback(src) {
        lbImg.onerror = null;
        lbImg.src = src;

        lbImg.onerror = function () {
          const lower = src.toLowerCase();
          if (lower.endsWith('.png')) {
            lbImg.onerror = null;
            lbImg.src = src.replace(/\.png$/i, '.jpg');
            lbImg.onerror = function () {
              lbImg.onerror = null;
              lbImg.src = src.replace(/\.png$/i, '.jpeg');
            };
          } else if (lower.endsWith('.jpg')) {
            lbImg.onerror = null;
            lbImg.src = src.replace(/\.jpg$/i, '.jpeg');
          }
        };
      }

      function openAt(index) {
        if (index < 0 || index >= zoomLinks.length) return;
        currentIndex = index;

        const a = zoomLinks[index];
        const src = a.getAttribute('data-src') || a.getAttribute('href') || '';
        const alt = a.getAttribute('data-alt') || '';
        const cap = a.getAttribute('data-cap') || '';

        lbTitle.textContent = alt || 'Imagem';
        lbCaption.textContent = cap || '';
        lbImg.alt = alt || '';

        resetTransform();
        setImageWithFallback(src);

        lightbox.classList.add('is-open');
        lightbox.setAttribute('aria-hidden', 'false');
        document.body.style.overflow = 'hidden';

        // esconder topnav para não atrapalhar
        if (topnav) topnav.classList.add('is-hidden');
      }

      function close() {
        lightbox.classList.remove('is-open');
        lightbox.setAttribute('aria-hidden', 'true');
        document.body.style.overflow = '';

        isDragging = false;
        lbStage.classList.remove('is-dragging');

        // voltar topnav
        if (topnav) topnav.classList.remove('is-hidden');
      }

      function zoomStep(delta) {
        const next = Math.max(1, Math.min(6, scale + delta));
        scale = next;
        applyTransform();
      }

      function zoomBy(factor) {
        const next = Math.max(1, Math.min(6, scale * factor));
        scale = next;
        applyTransform();
      }

      function prev() { openAt((currentIndex - 1 + zoomLinks.length) % zoomLinks.length); }
      function next() { openAt((currentIndex + 1) % zoomLinks.length); }

      // Thumbnail click
      zoomLinks.forEach((a, i) => {
        a.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          openAt(i);
        });
      });

      // Close when clicking overlay background
      lightbox.addEventListener('click', (e) => {
        if (e.target === lightbox) close();
      });

      lbClose.addEventListener('click', close);
      lbPrev.addEventListener('click', prev);
      lbNext.addEventListener('click', next);

      lbZoomIn.addEventListener('click', () => zoomStep(0.25));
      lbZoomOut.addEventListener('click', () => zoomStep(-0.25));
      lbZoomReset.addEventListener('click', resetTransform);

      // Keyboard
      window.addEventListener('keydown', (e) => {
        if (!lightbox.classList.contains('is-open')) return;

        if (e.key === 'Escape') close();
        if (e.key === 'ArrowLeft') prev();
        if (e.key === 'ArrowRight') next();
        if (e.key === '+' || e.key === '=') zoomStep(0.25);
        if (e.key === '-') zoomStep(-0.25);
        if (e.key === '0') resetTransform();
      });

      // Wheel zoom
      lbStage.addEventListener('wheel', (e) => {
        if (!lightbox.classList.contains('is-open')) return;
        e.preventDefault();
        const factor = e.deltaY < 0 ? 1.08 : 0.92;
        zoomBy(factor);
      }, { passive: false });

      // Drag to pan (only when zoomed in)
      function onPointerDown(e) {
        if (!lightbox.classList.contains('is-open')) return;
        if (scale <= 1) return;

        isDragging = true;
        lbStage.classList.add('is-dragging');

        startX = e.clientX;
        startY = e.clientY;
        startTx = tx;
        startTy = ty;

        lbStage.setPointerCapture(e.pointerId);
      }

      function onPointerMove(e) {
        if (!isDragging) return;

        const dx = e.clientX - startX;
        const dy = e.clientY - startY;

        tx = startTx + dx;
        ty = startTy + dy;
        applyTransform();
      }

      function onPointerUp(e) {
        if (!isDragging) return;
        isDragging = false;
        lbStage.classList.remove('is-dragging');
        try { lbStage.releasePointerCapture(e.pointerId); } catch (_) {}
      }

      lbStage.addEventListener('pointerdown', onPointerDown);
      lbStage.addEventListener('pointermove', onPointerMove);
      lbStage.addEventListener('pointerup', onPointerUp);
      lbStage.addEventListener('pointercancel', onPointerUp);

      // Double click to toggle zoom
      lbStage.addEventListener('dblclick', () => {
        if (!lightbox.classList.contains('is-open')) return;
        if (scale === 1) { scale = 2; applyTransform(); }
        else resetTransform();
      });
    })();
  </script>
</body>
</html>
